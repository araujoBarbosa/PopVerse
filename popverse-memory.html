<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <title>PopVerse ‚Äì Idol Memory</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Estilo r√°pido s√≥ deste jogo -->
    <style>
        :root {
            --pv-bg: #050315;
            --pv-card-back: #1a1035;
            --pv-card-border: #7c4dff;
            --pv-neon: #b388ff;
            --pv-accent: #ff80ab;
            --pv-text: #f9f7ff;
            --pv-danger: #ff5252;
            --pv-success: #69f0ae;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background: radial-gradient(circle at top, #311b92 0, #050315 45%, #000 100%);
            color: var(--pv-text);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 16px;
        }

        .memory-page {
            width: 100%;
            max-width: 960px;
            background: rgba(7, 5, 24, 0.92);
            border-radius: 24px;
            box-shadow: 0 0 40px rgba(179, 136, 255, 0.3);
            padding: 20px;
            border: 1px solid rgba(124, 77, 255, 0.4);
            backdrop-filter: blur(10px);
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .logo {
            font-family: "Montserrat", system-ui, sans-serif;
            font-weight: 800;
            letter-spacing: 0.08em;
            text-transform: uppercase;
            font-size: 1.1rem;
        }

        .logo span {
            color: var(--pv-neon);
        }

        .subtitle {
            font-size: 0.9rem;
            opacity: 0.85;
        }

        .btn-small {
            padding: 8px 14px;
            border-radius: 999px;
            border: 1px solid rgba(179, 136, 255, 0.6);
            background: rgba(25, 18, 51, 0.9);
            color: var(--pv-text);
            font-size: 0.8rem;
            cursor: pointer;
            transition: transform 0.15s ease, box-shadow 0.15s ease, background 0.15s ease;
        }

        .btn-small:hover {
            transform: translateY(-1px);
            box-shadow: 0 0 12px rgba(179, 136, 255, 0.7);
        }

        .hud {
            display: grid;
            grid-template-columns: 2fr 1.5fr 1fr;
            gap: 16px;
            align-items: center;
            margin-bottom: 20px;
        }

        .hud-section {
            background: rgba(15, 10, 40, 0.9);
            border-radius: 16px;
            padding: 10px 12px;
            border: 1px solid rgba(124, 77, 255, 0.35);
        }

        .hud-title {
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            opacity: 0.65;
            margin-bottom: 4px;
        }

        .hud-value {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 8px;
            font-size: 0.9rem;
        }

        .xp-bar {
            position: relative;
            width: 100%;
            height: 10px;
            border-radius: 999px;
            background: rgba(36, 26, 90, 0.9);
            overflow: hidden;
        }

        .xp-bar-fill {
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 30%;
            border-radius: inherit;
            background: linear-gradient(90deg, #7c4dff, #b388ff, #ff80ab);
            box-shadow: 0 0 12px rgba(179, 136, 255, 0.9);
            transition: width 0.4s ease;
        }

        .xp-label {
            font-size: 0.75rem;
            opacity: 0.8;
        }

        .badge-level {
            padding: 4px 10px;
            border-radius: 999px;
            background: radial-gradient(circle at top, #b388ff, #7c4dff);
            font-size: 0.75rem;
            font-weight: 700;
            box-shadow: 0 0 10px rgba(185, 159, 255, 0.8);
        }

        .hud-numbers {
            display: flex;
            gap: 8px;
            font-size: 0.85rem;
        }

        .tag-pill {
            padding: 4px 8px;
            border-radius: 999px;
            background: rgba(30, 21, 75, 0.9);
            border: 1px solid rgba(124, 77, 255, 0.4);
            font-size: 0.75rem;
        }

        .memory-grid {
            display: grid;
            grid-template-columns: repeat(4, minmax(60px, 1fr));
            gap: 12px;
        }

        @media (min-width: 768px) {
            .memory-grid {
                gap: 16px;
            }
        }

        .card {
            position: relative;
            width: 100%;
            aspect-ratio: 1 / 1;
            perspective: 1000px;
            cursor: pointer;
        }

        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transform-style: preserve-3d;
            transition: transform 0.4s ease;
        }

        .card.flipped .card-inner,
        .card.matched .card-inner {
            transform: rotateY(180deg);
        }

        .card-face {
            position: absolute;
            inset: 0;
            backface-visibility: hidden;
            border-radius: 18px;
            border: 1px solid rgba(179, 136, 255, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .card-back {
            background: radial-gradient(circle at top, #4527a0 0, #1a1035 50%, #050315 100%);
            box-shadow:
                0 0 10px rgba(179, 136, 255, 0.8),
                0 0 22px rgba(124, 77, 255, 0.7);
            position: relative;
            overflow: hidden;
        }

        .card-back::before {
            content: "üé§";
            font-size: 2.4rem;
            text-shadow: 0 0 12px rgba(179, 136, 255, 0.9);
        }

        .card-back::after {
            content: "PopVerse";
            position: absolute;
            bottom: 10px;
            font-size: 0.7rem;
            letter-spacing: 0.18em;
            text-transform: uppercase;
            color: rgba(249, 247, 255, 0.7);
        }

        .card-front {
            transform: rotateY(180deg);
            background: radial-gradient(circle at top, #311b92 0, #0d0630 45%, #000 100%);
            box-shadow: 0 0 12px rgba(98, 0, 234, 0.6);
            flex-direction: column;
            gap: 6px;
            text-align: center;
            padding: 6px;
        }

        .card-emoji {
            font-size: 2rem;
            margin-bottom: 2px;
        }

        .card-label {
            font-size: 0.7rem;
            opacity: 0.82;
        }

        .card.matched {
            cursor: default;
        }

        .card.matched .card-front {
            box-shadow: 0 0 16px rgba(105, 240, 174, 0.9);
            border-color: rgba(105, 240, 174, 0.9);
        }

        .floating-xp {
            position: absolute;
            top: 8px;
            right: 10px;
            font-size: 0.8rem;
            color: var(--pv-success);
            text-shadow: 0 0 10px rgba(105, 240, 174, 0.9);
            opacity: 0;
            transform: translateY(8px);
            pointer-events: none;
            transition: opacity 0.3s ease, transform 0.3s ease;
        }

        .floating-xp.show {
            opacity: 1;
            transform: translateY(-6px);
        }

        .actions-row {
            margin-top: 16px;
            display: flex;
            justify-content: space-between;
            gap: 12px;
        }

        .btn-primary {
            flex: 1;
            padding: 10px 16px;
            border-radius: 999px;
            border: none;
            background: linear-gradient(90deg, #7c4dff, #b388ff, #ff80ab);
            color: #0b0718;
            font-weight: 700;
            font-size: 0.9rem;
            cursor: pointer;
            box-shadow: 0 0 16px rgba(179, 136, 255, 0.8);
            transition: transform 0.12s ease, box-shadow 0.12s ease;
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 0 22px rgba(179, 136, 255, 1);
        }

        .btn-ghost {
            flex: 1;
            padding: 10px 16px;
            border-radius: 999px;
            border: 1px solid rgba(124, 77, 255, 0.5);
            background: transparent;
            color: var(--pv-text);
            font-size: 0.9rem;
            cursor: pointer;
            transition: background 0.12s ease, transform 0.12s ease, box-shadow 0.12s ease;
        }

        .btn-ghost:hover {
            background: rgba(25, 18, 51, 0.9);
            box-shadow: 0 0 12px rgba(124, 77, 255, 0.8);
            transform: translateY(-1px);
        }

        .modal-backdrop {
            position: fixed;
            inset: 0;
            background: radial-gradient(circle at top, rgba(124, 77, 255, 0.4), rgba(3, 0, 30, 0.93));
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 16px;
            z-index: 50;
        }

        .hidden {
            display: none !important;
        }

        .modal {
            max-width: 420px;
            width: 100%;
            background: rgba(7, 5, 24, 0.98);
            border-radius: 24px;
            padding: 20px;
            border: 1px solid rgba(179, 136, 255, 0.7);
            box-shadow: 0 0 26px rgba(179, 136, 255, 0.9);
        }

        .modal h2 {
            font-size: 1.1rem;
            margin-bottom: 8px;
        }

        .modal p {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-bottom: 12px;
        }

        .modal-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 10px 0 16px;
        }

        .modal-stat {
            background: rgba(20, 13, 60, 0.95);
            border-radius: 14px;
            padding: 8px;
            border: 1px solid rgba(124, 77, 255, 0.4);
            font-size: 0.8rem;
            text-align: center;
        }

        .modal-stat strong {
            display: block;
            font-size: 0.9rem;
            margin-top: 3px;
        }

        .modal-actions {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        @media (min-width: 600px) {
            .modal-actions {
                flex-direction: row;
            }
        }
    </style>
</head>

<body>
    <main class="memory-page">
        <header>
            <div>
                <div class="logo"><span>Pop</span>Verse</div>
                <div class="subtitle">Idol Memory ‚Äì Ganhe XP para o seu avatar ‚ú®</div>
            </div>
            <button class="btn-small" type="button" onclick="window.location.href='avatar.html'">
                ‚Üê Voltar para o avatar
            </button>
        </header>

        <section class="hud">
            <!-- XP / N√≠vel -->
            <div class="hud-section">
                <div class="hud-title">Progresso do avatar</div>
                <div class="hud-value">
                    <div style="flex: 1;">
                        <div class="xp-bar">
                            <div class="xp-bar-fill" id="xpBarFill"></div>
                        </div>
                        <div class="xp-label" id="xpLabel">XP 0 / 100</div>
                    </div>
                    <span class="badge-level" id="levelBadge">N√≠vel 1</span>
                </div>
            </div>

            <!-- Tempo / Movimentos -->
            <div class="hud-section">
                <div class="hud-title">Partida atual</div>
                <div class="hud-value">
                    <div class="hud-numbers">
                        <span class="tag-pill">‚è±Ô∏è <span id="timeValue">60s</span></span>
                        <span class="tag-pill">üë£ <span id="movesValue">0 jogadas</span></span>
                    </div>
                </div>
            </div>

            <!-- Status -->
            <div class="hud-section">
                <div class="hud-title">Status</div>
                <div class="hud-value">
                    <span id="statusLabel">Memorize e encontre os pares üíú</span>
                </div>
            </div>
        </section>

        <section class="memory-grid" id="memoryGrid">
            <!-- Cartas geradas via JS -->
        </section>

        <div class="actions-row">
            <button class="btn-primary" type="button" id="btnRestart">‚Üª Jogar novamente</button>
            <button class="btn-ghost" type="button" id="btnRules">Como funciona?</button>
        </div>
    </main>

    <!-- Modal fim de jogo -->
    <div class="modal-backdrop hidden" id="endModal">
        <div class="modal">
            <h2 id="endTitle">Voc√™ mandou bem! üíú</h2>
            <p id="endMessage">Veja como voc√™ foi nessa rodada:</p>

            <div class="modal-stats">
                <div class="modal-stat">
                    Tempo
                    <strong id="endTime">--s</strong>
                </div>
                <div class="modal-stat">
                    Jogadas
                    <strong id="endMoves">--</strong>
                </div>
                <div class="modal-stat">
                    XP ganho
                    <strong id="endXP">+0</strong>
                </div>
            </div>

            <div class="modal-actions">
                <button class="btn-primary" type="button" id="modalPlayAgain">Jogar de novo</button>
                <button class="btn-ghost" type="button" onclick="window.location.href='avatar.html'">
                    Voltar para o avatar
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de regras -->
    <div class="modal-backdrop hidden" id="rulesModal">
        <div class="modal">
            <h2>Como funciona o Idol Memory üéÆ</h2>
            <p>
                Vire as cartas e tente encontrar os pares K-pop (lightsticks, √≠cones e mascotes PopVerse).
                Complete o tabuleiro antes do tempo acabar para ganhar mais XP!
            </p>
            <ul style="font-size:0.85rem; opacity:0.9; margin: 8px 0 16px 16px; list-style: disc;">
                <li>Cada par correto = ganha XP.</li>
                <li>Terminar r√°pido = b√¥nus de XP.</li>
                <li>XP sobe o n√≠vel e libera melhorias no avatar.</li>
            </ul>
            <div class="modal-actions">
                <button class="btn-primary" type="button" id="rulesClose">Entendi, vamos jogar!</button>
            </div>
        </div>
    </div>

    <script>
        // ==========================
        // CONFIG DE N√çVEL / XP
        // ==========================
        const XP_KEY = "popverseXP";
        const LEVEL_KEY = "popverseLevel"; // opcional, pode ser recalculado sempre

        // thresholds simples: quando passa desses valores, sobe n√≠vel
        const LEVEL_THRESHOLDS = [0, 100, 250, 500, 800, 1200];

        function getCurrentXP() {
            return parseInt(localStorage.getItem(XP_KEY) || "0", 10);
        }

        function saveCurrentXP(xp) {
            localStorage.setItem(XP_KEY, String(xp));
        }

        function computeLevel(xp) {
            let level = 1;
            for (let i = 0; i < LEVEL_THRESHOLDS.length; i++) {
                if (xp >= LEVEL_THRESHOLDS[i]) {
                    level = i + 1;
                }
            }
            return level;
        }

        function updateXPUI() {
            const xp = getCurrentXP();
            const level = computeLevel(xp);

            const currentThreshold = LEVEL_THRESHOLDS[level - 1] || 0;
            const nextThreshold = LEVEL_THRESHOLDS[level] || (currentThreshold + 400);

            const diff = nextThreshold - currentThreshold;
            const progress = diff > 0 ? (xp - currentThreshold) / diff : 1;

            const fill = document.getElementById("xpBarFill");
            const label = document.getElementById("xpLabel");
            const badge = document.getElementById("levelBadge");

            if (fill) fill.style.width = `${Math.min(100, Math.max(0, progress * 100))}%`;
            if (label) label.textContent = `XP ${xp} / ${nextThreshold}`;
            if (badge) badge.textContent = `N√≠vel ${level}`;

            localStorage.setItem(LEVEL_KEY, String(level));
        }

        function addXP(amount) {
            const before = getCurrentXP();
            const after = before + amount;
            saveCurrentXP(after);
            updateXPUI();
        }

        // ====================================
        // JOGO DA MEM√ìRIA ‚Äì L√ìGICA PRINCIPAL
        // ====================================

        const cardsBase = [
            { id: "light1", emoji: "‚ú®", label: "Lightstick Roxo" },
            { id: "light2", emoji: "üíó", label: "Lightstick Rosa" },
            { id: "iconMic", emoji: "üé§", label: "√çcone PopVerse" },
            { id: "iconStar", emoji: "‚≠ê", label: "Estrela do Palco" },
            { id: "heartBeat", emoji: "üíú", label: "Cora√ß√£o K-pop" },
            { id: "mascote1", emoji: "üê∞", label: "Mascote Fofo" },
            { id: "mascote2", emoji: "üéß", label: "Mascote DJ" },
            { id: "mascote3", emoji: "ü™©", label: "Bola de Luz" }
        ];

        let gameCards = [];
        let firstCard = null;
        let secondCard = null;
        let lockBoard = false;
        let moves = 0;
        let matches = 0;
        let timeLeft = 60;
        let timerId = null;
        let gameEnded = false;

        const gridEl = document.getElementById("memoryGrid");
        const timeEl = document.getElementById("timeValue");
        const movesEl = document.getElementById("movesValue");
        const statusEl = document.getElementById("statusLabel");
        const btnRestart = document.getElementById("btnRestart");
        const btnRules = document.getElementById("btnRules");

        const endModal = document.getElementById("endModal");
        const endTitle = document.getElementById("endTitle");
        const endMessage = document.getElementById("endMessage");
        const endTimeEl = document.getElementById("endTime");
        const endMovesEl = document.getElementById("endMoves");
        const endXPEl = document.getElementById("endXP");
        const modalPlayAgain = document.getElementById("modalPlayAgain");

        const rulesModal = document.getElementById("rulesModal");
        const rulesClose = document.getElementById("rulesClose");

        function shuffleArray(arr) {
            const a = arr.slice();
            for (let i = a.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [a[i], a[j]] = [a[j], a[i]];
            }
            return a;
        }

        function createGameCards() {
            const duplicated = [...cardsBase, ...cardsBase]; // 8 pares
            gameCards = shuffleArray(duplicated).map((card, index) => ({
                ...card,
                uid: index // unique id
            }));
        }

        function renderBoard() {
            gridEl.innerHTML = "";
            gameCards.forEach(card => {
                const cardEl = document.createElement("div");
                cardEl.className = "card";
                cardEl.dataset.id = card.id;
                cardEl.dataset.uid = card.uid;

                const cardInner = document.createElement("div");
                cardInner.className = "card-inner";

                const back = document.createElement("div");
                back.className = "card-face card-back";

                const front = document.createElement("div");
                front.className = "card-face card-front";

                const emojiEl = document.createElement("div");
                emojiEl.className = "card-emoji";
                emojiEl.textContent = card.emoji;

                const labelEl = document.createElement("div");
                labelEl.className = "card-label";
                labelEl.textContent = card.label;

                front.appendChild(emojiEl);
                front.appendChild(labelEl);

                cardInner.appendChild(back);
                cardInner.appendChild(front);
                cardEl.appendChild(cardInner);

                cardEl.addEventListener("click", () => handleCardClick(cardEl, card));

                gridEl.appendChild(cardEl);
            });
        }

        function resetGame() {
            if (timerId) {
                clearInterval(timerId);
                timerId = null;
            }
            firstCard = null;
            secondCard = null;
            lockBoard = false;
            moves = 0;
            matches = 0;
            timeLeft = 60;
            gameEnded = false;

            if (timeEl) timeEl.textContent = `${timeLeft}s`;
            if (movesEl) movesEl.textContent = `${moves} jogadas`;
            if (statusEl) statusEl.textContent = "Memorize e encontre os pares üíú";

            createGameCards();
            renderBoard();
            startTimer();
        }

        function startTimer() {
            timerId = setInterval(() => {
                if (gameEnded) {
                    clearInterval(timerId);
                    timerId = null;
                    return;
                }
                timeLeft--;
                if (timeLeft < 0) timeLeft = 0;
                if (timeEl) timeEl.textContent = `${timeLeft}s`;

                if (timeLeft === 0) {
                    endGame(false);
                }
            }, 1000);
        }

        function handleCardClick(cardEl, cardData) {
            if (lockBoard || gameEnded) return;
            if (cardEl.classList.contains("flipped") || cardEl.classList.contains("matched")) return;

            cardEl.classList.add("flipped");

            if (!firstCard) {
                firstCard = { cardEl, cardData };
                return;
            }

            secondCard = { cardEl, cardData };
            moves++;
            if (movesEl) movesEl.textContent = `${moves} jogadas`;

            if (firstCard.cardData.id === secondCard.cardData.id) {
                // acerto
                handleMatch();
            } else {
                // erro
                handleMismatch();
            }
        }

        function handleMatch() {
            if (statusEl) statusEl.textContent = "Boa! Voc√™ acertou um par! üéâ";
            lockBoard = true;

            setTimeout(() => {
                if (!firstCard || !secondCard) return;

                firstCard.cardEl.classList.remove("flipped");
                secondCard.cardEl.classList.remove("flipped");
                firstCard.cardEl.classList.add("matched");
                secondCard.cardEl.classList.add("matched");

                showFloatingXP(firstCard.cardEl, 15);
                showFloatingXP(secondCard.cardEl, 0); // s√≥ anima√ß√£o extra

                addXP(15); // XP por par
                matches++;

                firstCard = null;
                secondCard = null;
                lockBoard = false;

                if (matches === cardsBase.length) {
                    endGame(true);
                }
            }, 350);
        }

        function handleMismatch() {
            if (statusEl) statusEl.textContent = "Tente novamente! Memorize bem üòâ";
            lockBoard = true;
            setTimeout(() => {
                if (firstCard) firstCard.cardEl.classList.remove("flipped");
                if (secondCard) secondCard.cardEl.classList.remove("flipped");
                firstCard = null;
                secondCard = null;
                lockBoard = false;
            }, 600);
        }

        function showFloatingXP(cardEl, amount) {
            if (amount <= 0) return;
            const xpEl = document.createElement("div");
            xpEl.className = "floating-xp";
            xpEl.textContent = `+${amount} XP`;
            cardEl.appendChild(xpEl);

            requestAnimationFrame(() => {
                xpEl.classList.add("show");
            });

            setTimeout(() => {
                xpEl.classList.remove("show");
                setTimeout(() => xpEl.remove(), 200);
            }, 700);
        }

        function endGame(won) {
            if (gameEnded) return;
            gameEnded = true;
            if (timerId) {
                clearInterval(timerId);
                timerId = null;
            }

            let bonusXP = 0;
            if (won) {
                bonusXP = Math.max(0, timeLeft * 2); // b√¥nus por tempo
                addXP(bonusXP);
            }

            // Atualiza UI do modal
            if (won) {
                endTitle.textContent = "Arrasou no palco! üíú";
                endMessage.textContent = "Voc√™ completou todos os pares. Seu avatar vai amar esse XP!";
            } else {
                endTitle.textContent = "Quase l√°! üëÄ";
                endMessage.textContent = "O tempo acabou, mas voc√™ pode tentar novamente e ganhar mais XP.";
            }

            endTimeEl.textContent = `${60 - timeLeft}s`;
            endMovesEl.textContent = String(moves);
            endXPEl.textContent = `+${won ? matches * 15 + bonusXP : matches * 15}`;

            endModal.classList.remove("hidden");
        }

        // ======================
        // EVENTOS B√ÅSICOS
        // ======================
        btnRestart.addEventListener("click", () => {
            endModal.classList.add("hidden");
            resetGame();
        });

        modalPlayAgain.addEventListener("click", () => {
            endModal.classList.add("hidden");
            resetGame();
        });

        btnRules.addEventListener("click", () => {
            rulesModal.classList.remove("hidden");
        });

        rulesClose.addEventListener("click", () => {
            rulesModal.classList.add("hidden");
        });

        // ======================
        // START
        // ======================
        updateXPUI();
        resetGame();
    </script>
</body>

</html>